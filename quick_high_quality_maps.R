# Create quick high quality maps with R
# Jan-Philipp Kolb
# Tue Jul 06 18:31:01 2021


## -----------------------------------------------------------------------------------
library(maps)
data(world.cities)
map()
map.cities(world.cities,col=rgb(0,0,1,.05),pch=20)


## -----------------------------------------------------------------------------------------------------
library(maptools)
data("wrld_simpl")
plot(wrld_simpl,col="royalblue")


## -----------------------------------------------------------------------------------------------------
library(maptools)
data("wrld_simpl")
plot(wrld_simpl,col=c("#CD3333"))


## ----eval=F-------------------------------------------------------------------------------------------
## head(wrld_simpl@data)


## -----------------------------------------------------------------------------------------------------
sp::spplot(wrld_simpl,"AREA")


## ----eval=F-------------------------------------------------------------------------------------------
## library(tmap)
## data(World)
## qtm(World)


## ----out.height = "80%"-------------------------------------------------------------------------------
library(tmap)
data(World)
qtm(World, fill="economy")


## -----------------------------------------------------------------------------------------------------
qtm(World, fill="pop_est", text="iso_a3")


## -----------------------------------------------------------------------------------------------------
qtm(World, fill="gdp_cap_est", text="iso_a3", 
    text.size="AREA")


## -----------------------------------------------------------------------------------------------------
qtm(World, fill="continent")


## ----eval=F-------------------------------------------------------------------------------------------
## qtm(World, fill="part",fill.title="Teil von Europa")


## -----------------------------------------------------------------------------------------------------
qtm(World, fill="area") # Russia is huge


## -----------------------------------------------------------------------------------------------------
qtm(World, fill="pop_est",fill.title="Population") 


## ----eval=T-------------------------------------------------------------------------------------------
tm_shape(World) + tm_fill(c("pop_est", "economy"), 
        title=c("Population", "Economy"))


## -----------------------------------------------------------------------------------------------------
tm_shape(World[World$name=="Netherlands", ]) +
    tm_polygons()


## -----------------------------------------------------------------------------------------------------
data(NLD_muni)
qtm(NLD_muni,"population")


## -----------------------------------------------------------------------------------------------------
data(World,package="tmap")


## -----------------------------------------------------------------------------------------------------
library("choroplethr")
library("choroplethrMaps")
data(df_pop_state)
state_choropleth(df_pop_state)


## -----------------------------------------------------------------------------------------------------
state_choropleth(df_pop_state,
      zoom=c("california","nevada"))


## -----------------------------------------------------------------------------------------------------
state_choropleth(df_pop_state)


## ----out.height= "70%"--------------------------------------------------------------------------------
library(tidycensus)
data(county_laea)

qtm(county_laea,fill=c("#8B1A1A"))


## -----------------------------------------------------------------------------------------------------
library(globe)
globeearth(eye=place("titanic"),col="royalblue")


## ----out.height = "80%"-------------------------------------------------------------------------------
globeearth(eye=place("southpole"),col="royalblue")


## -----------------------------------------------------------------------------------------------------
library(sf)


## -----------------------------------------------------------------------------------------------------
library(dplyr)
library(ggplot2)


## -----------------------------------------------------------------------------------------------------
library(eurostat)


## ----eval=F-------------------------------------------------------------------------------------------
## # Download Geospatial Data from GISCO:
## df60 <- get_eurostat_geospatial(resolution = 60)
## # Same data - less detailed:
## df1 <- get_eurostat_geospatial(resolution = 1)


## ----eval=F,echo=F------------------------------------------------------------------------------------
## save(df10,file="data/eurostat_df10.RData")
## save(df1,file="data/eurostat_df1.RData")


## ----echo=F-------------------------------------------------------------------------------------------
load("data/eurostat_df60.RData")
load("data/eurostat_df10.RData")
load("data/eurostat_df1.RData")


## -----------------------------------------------------------------------------------------------------
plot(df60[df60$LEVL_CODE == 0 & 
            df60$CNTR_CODE == "NL",1])


## -----------------------------------------------------------------------------------------------------
plot(df60[df60$LEVL_CODE == 0 & df60$CNTR_CODE == "NL",1],
     col="blue",main="df60")
plot(df1[df1$LEVL_CODE == 0 & df1$CNTR_CODE == "NL",1],col="red",main="df1")


## ----out.width = "50%"--------------------------------------------------------------------------------
CE.sf <- df60 %>%   
  filter(LEVL_CODE == 2 & 
  CNTR_CODE %in% c("NL")) %>% 
  select(NUTS_ID) 
plot(CE.sf,col=1:12)


## ----eval=F-------------------------------------------------------------------------------------------
## library(leaflet)
## leaflet(CE.sf) %>%
##   addProviderTiles("CartoDB.Positron") %>%
##   addPolygons(color = "green")


## -----------------------------------------------------------------------------------------------------
class(World)


## ----eval=F-------------------------------------------------------------------------------------------
## FRA4 <- raster::getData('GADM', country='FRA',
##                         level=4)


## ----eval=F,echo=F------------------------------------------------------------------------------------
## save(FRA4,file="data/FRA4.RData")


## ----eval=T,echo=F------------------------------------------------------------------------------------
load("data/FRA4.RData")


## -----------------------------------------------------------------------------------------------------
qtm(FRA4,fill="blue")


## ----out.width = "80%"--------------------------------------------------------------------------------
FRA4$fantasy_val <- runif(nrow(FRA4))
  qtm(FRA4,"fantasy_val", 
      fill.palette = rgb(0,0,seq(0,1,.1),0),
      borders = "blue")


## ----echo=F,eval=F------------------------------------------------------------------------------------
## FRA4$fantasy_val <- runif(nrow(FRA4))
## png("maps/map_challenge_day5.png")
##   qtm(FRA4,"fantasy_val", fill.palette = rgb(0,0,seq(0,1,.1),0),borders = "blue")
## dev.off()


## -----------------------------------------------------------------------------------------------------
library(tmaptools)


## ----eval=F-------------------------------------------------------------------------------------------
## citation("tmaptools")


## -----------------------------------------------------------------------------------------------------
(gc_z <- geocode_OSM("Zürich"))


## -----------------------------------------------------------------------------------------------------
gc_z <- geocode_OSM("Zürich",details = T)
names(gc_z)


## ----eval=F-------------------------------------------------------------------------------------------
## library(leaflet)
## gcz <- geocode_OSM("Zürich")
## leaflet() %>%  addTiles() %>%
##   addMarkers(lng=gcz$coords[1] , lat=gcz$coords[2] ,
##              popup="The conference place")
## 


## ----watercolor_zuri,eval=F---------------------------------------------------------------------------
## library(ggmap)
## myMap <- get_stamenmap(bbox=c(8.448006, 47.320220,
##                               8.625441, 47.434666 ),
##                   maptype="watercolor", crop=TRUE)
## ggmap(myMap)


## -----------------------------------------------------------------------------------------------------
url <- "https://raw.githubusercontent.com/Japhilko/
GeoData/master/2015/data/Unemployment07a13.csv"

Unemp <- read.csv(url) 


## -----------------------------------------------------------------------------------------------------
vec_a <- c("A",2,6,1,"C")
vec_b <- c(1,"C",2)


## -----------------------------------------------------------------------------------------------------
match(vec_a,vec_b)


## ----warning=F----------------------------------------------------------------------------------------
library("tmap")


## -----------------------------------------------------------------------------------------------------
iso_a2<- substr(World$iso_a3,1,2)
ind <- match(iso_a2,Unemp$GEO)
World$Val2007M12 <- Unemp$Val2007M12[ind]
World$Val2013M01 <- Unemp$Val2013M01[ind]


## -----------------------------------------------------------------------------------------------------
qtm(World,c("Val2007M12","Val2013M01"))


## -----------------------------------------------------------------------------------------------------
library(osmplotr)


## ----eval=F-------------------------------------------------------------------------------------------
## citation("osmplotr")


## ----cache=T,eval=F-----------------------------------------------------------------------------------
## bbox <- get_bbox (c(8.4539 , 49.4805  ,
##                     8.4774 , 49.4943 ))
## dat_M <- extract_osm_objects (key = 'building',
##                               bbox = bbox)


## ----eval=F,echo=F------------------------------------------------------------------------------------
## save(dat_M,file="data/osm_mannheim.Rdata")


## ----echo=F-------------------------------------------------------------------------------------------
load("data/osm_mannheim.Rdata")


## ----eval=F-------------------------------------------------------------------------------------------
## qtm(dat_M,fill=c("purple"),borders="black")


## ---- out.width = "70%"-------------------------------------------------------------------------------
library(ggmap)
ggplot() + geom_sf(data=dat_M, colour="#238443",
    fill="#004529", alpha=.5) + labs(x="",y="")


## ----eval=F-------------------------------------------------------------------------------------------
## dat_h <- extract_osm_objects (key = 'highway',
##                               bbox = bbox)


## ----eval=F-------------------------------------------------------------------------------------------
## m + geom_sf(data=dat_h)


## ----eval=F-------------------------------------------------------------------------------------------
## install.packages("osmdata")


## -----------------------------------------------------------------------------------------------------
library(osmdata)


## -----------------------------------------------------------------------------------------------------
bbox <- osmdata::getbb("Berlin")


## ----echo=F-------------------------------------------------------------------------------------------
load("data/primary_highway_berlin.RData")


## ----eval=F-------------------------------------------------------------------------------------------
## dat <- extract_osm_objects(key = 'highway',
##                               value = "primary",
##                               bbox = bbox)


## ---- out.width = "80%"-------------------------------------------------------------------------------
qtm(dat)


## ----eval=F-------------------------------------------------------------------------------------------
## dat_s <- extract_osm_objects(key = 'highway',
##                            value = "secondary",
##                            bbox = bbox)


## ----echo=F-------------------------------------------------------------------------------------------
load("data//secondary_highway_berlin.RData")


## ----eval=F-------------------------------------------------------------------------------------------
## map <- osm_basemap(bbox = bbox, bg = "#F5F5DC")
## map <- add_osm_objects(map, dat, col = "#00008B")
## map <- add_osm_objects(map, dat_s, col = "purple")
## print_osm_map(map)


## ----echo=F-------------------------------------------------------------------------------------------
library(tmaptools)
library(osmplotr)
library(tmap)


## ----eval=F-------------------------------------------------------------------------------------------
## dat_p <- extract_osm_objects (key = 'route',
##                   value="subway", bbox = bbox)


## ----eval=F,echo=F------------------------------------------------------------------------------------
## save(dat_p,file="data/metro_berlin.RData")


## ----echo=F-------------------------------------------------------------------------------------------
load("data/metro_berlin.RData")


## -----------------------------------------------------------------------------------------------------
qtm(dat_p,"colors")


## ----out.width = "80%"--------------------------------------------------------------------------------
library(elevatr)
elevation <- get_elev_raster(dat, z = 9)
plot(elevation)

