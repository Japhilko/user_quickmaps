---
title: "Quick high quality maps with R"
author: "Jan-Philipp Kolb"
date: "23 6 2021"
output: 
  beamer_presentation: 
    theme: PaloAlto
    colortheme: dolphin
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T,warning=F,message=F)
```

## Preliminaries

- Usually I have big differences in knowledge and abilities of the participants - please tell, if it is too fast or slow.
- I have lots of hands-on coding [**exercises**](http://web.math.ku.dk/~helle/R-intro/exercises.pdf) - later you can only learn on your own
- We have many [**examples**](https://www.showmeshiny.com/) - try them
- If there are questions - always ask
- R is more fun together  - strong proponent of
collaborative work!



## Adjustments for online course

- Quick 
- One slide - one example - 
- Easy to use




## Getting help on packages

```{r,eval=F}
# provides details regarding contents of a package
help(package = "osmplotr")
# list vignettes available for a specific package
vignette(package="osmplotr")
# view specific vignette
vignette("data-maps")
```



## The `World` dataset

### Natural Earth

- Dataset contains information from [**Natural Earth**](http://www.naturalearthdata.com/)

```{r}
library(tmap)
data(World)
```

![](pics/NaturalEarthData.PNG)



## The `qtm` command from the `tmap` package

### Fast thematic map

- With [**qtm**](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-nutshell.html) you can create a fast thematic map

- Example from the [**Vignette**](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-nutshell.html) for the `tmap` package

```{r,eval=F}
library(tmap)
data(World)
qtm(World)
```

![](pics/qtm_world2.PNG){width=50%}


## To get more color in the map

### Economic development status

<!--
<http://www.naturalearthdata.com/>
-->
```{r}
qtm(World, fill="economy")
```


## A map with text

### Population

```{r}
qtm(World, fill="pop_est", text="iso_a3")
```

## This Scheme is better:

### [**GDP per capita**](https://en.wikipedia.org/wiki/Population_density)

```{r}
qtm(World, fill="gdp_cap_est", text="iso_a3", 
    text.size="AREA")
```


## Topics of the World dataset

### Available variables in the data set

- [**ISO classification**](http://userpage.chemie.fu-berlin.de/diverse/doc/ISO_3166.html)
- country name
- Area, population, population density, 
- [**Gross Domestic Product**](https://en.wikipedia.org/wiki/Gross_domestic_product)
- Gross domestic product [**at purchasing power parities**](https://en.wikipedia.org/wiki/List_of_countries_by_GDP_%28PPP%29_per_capita)
- Economy, income group







### [**Variables of the World Dataset**](http://rpubs.com/Japhilko82/tmap_europe_dataset)

![](pics/world_dataset.PNG)




## The variable `continent`

```{r}
qtm(World, fill="continent")
```

<!--
## The variable `part`

```{r,eval=F}
qtm(World, fill="part",fill.title="Teil von Europa")
```
-->

## The variable `area`

```{r}
qtm(World, fill="area") # Russia is huge
```


## Population

```{r}
qtm(World, fill="pop_est",fill.title="Population") 
```


## Two maps

### Population and level of development

```{r,eval=T}
tm_shape(World) + tm_fill(c("pop_est", "economy"), 
        title=c("Population", "Economy"))
```


## Netherlands - Population in the provinces

```{r dataland,echo=F,eval=F}
data(land)
info_df <- land@data[1:100,]
datatable(info_df)
```

```{r}
data(land)
data(World)
```


```{r,echo=F,eval=F}
data(land)
info_df <- land[sample(1:length(land),10,replace=T),]
kable(info_df[,c(2,3)])
```

```{r,eval=F,echo=F}
?land
```



```{r}
tm_shape(land,  relative=FALSE) +
    tm_raster("trees", title="prop. wooded area")
```


## Visualize only one country

```{r}
tm_shape(World[World$name=="Austria", ]) +
    tm_polygons()
```


## The `raster` package



## GADM data 

```{r,eval=F}
FRA4 <- raster::getData('GADM', country='FRA', 
                        level=4)
```

```{r,eval=F,echo=F}
save(FRA4,file="data/FRA4.RData")
```


## Plot the map

```{r,eval=T,echo=F}
load("data/FRA4.RData")
```

```{r}
qtm(FRA4,fill="blue")
```


## Create colour gradiation

```{r}
FRA4$fantasy_val <- runif(nrow(FRA4))
  qtm(FRA4,"fantasy_val", 
      fill.palette = rgb(0,0,seq(0,1,.1),0),
      borders = "blue")
```




```{r,echo=F,eval=F}
FRA4$fantasy_val <- runif(nrow(FRA4))
png("maps/map_challenge_day5.png")
  qtm(FRA4,"fantasy_val", fill.palette = rgb(0,0,seq(0,1,.1),0),borders = "blue")
dev.off()
```




## `tmaptools` - Thematic Map Tools 

```{r}
library(tmaptools)
```

Author: Martijn Tennekes

```{r,eval=F}
citation("tmaptools")
```

![](pics/description_tmaptools.PNG)

## Geocoordinates

```{r}
(gc_z <- geocode_OSM("ZÃ¼rich"))
```



## A package to get Openstreetmap data

Author: Mark Padgham


```{r}
library(osmplotr)
```

```{r,eval=F}
citation("osmplotr")
```



![](pics/osmplotr_google.png)

## Buildings within a bounding box

```{r,cache=T,eval=F}
bbox <- get_bbox (c(8.4539 , 49.4805  , 
                    8.4774 , 49.4943 ))
dat_M <- extract_osm_objects (key = 'building', 
                              bbox = bbox)
```

```{r,eval=F,echo=F}
save(dat_M,file="data/osm_mannheim.Rdata")
```

```{r,echo=F}
load("data/osm_mannheim.Rdata")
```


```{r,eval=F}
qtm(dat_M,fill=c("purple"),borders="black")
```

![](pics/bui_mannheim.PNG){width=50%}

## Colour picker

![](pics/colourpicker.png)

## The package `osmdata`

```{r,eval=F}
install.packages("osmdata")
```

```{r}
library(osmdata)
```


### Get a bounding box for a city

```{r}
bbox <- getbb("Berlin")
```


## Streets of Berlin

### OSM Map Feature key=highway value=primary

![](pics/highway_primary_osmmapfeatures.PNG)


```{r,echo=F}
load("data/primary_highway_berlin.RData")
```

### Get data with package `osmdata`

```{r,eval=F}
dat <- extract_osm_objects(key = 'highway',
                              value = "primary",
                              bbox = bbox)
```

## A quick map for the primary streets in Berlin

```{r}
qtm(dat)
```

## 

```{r,eval=F}
dat_s <- extract_osm_objects(key = 'highway',
                           value = "secondary",
                           bbox = bbox)
```

```{r,echo=F}
load("data//secondary_highway_berlin.RData")
```



```{r}
map <- osm_basemap(bbox = bbox, bg = "#F5F5DC")
map <- add_osm_objects(map, dat, col = "#00008B")
map <- add_osm_objects(map, dat_s, col = "purple")
print_osm_map(map)
```


## 30daymapchallenge

![](pics/30daymapchallenge_copy_1jpg)


## Day 9 monochrome

![](pics/trier_monochrome.png)


## Load example data

### Data source Eurostat

- Data about unemployment in Europe

```{r}
url <- "https://raw.githubusercontent.com/Japhilko/
GeoData/master/2015/data/Unemployment07a13.csv"

Unemp <- read.csv(url) 
```


## Excursus: the command `match`

### Create two example vectors

```{r}
vec_a <- c("A",2,6,1,"C")
vec_b <- c(1,"C",2)
```

### Bringing the two vectors together

- With the function `match` you can see which element of the first vector matches the second vector.

```{r}
match(vec_a,vec_b)
```



## Use the package `tmap` with your data

```{r,warning=F}
library("tmap")
```

### Match the data

```{r}
iso_a2<- substr(World$iso_a3,1,2)
ind <- match(iso_a2,Unemp$GEO)
World$Val2007M12 <- Unemp$Val2007M12[ind]
World$Val2013M01 <- Unemp$Val2013M01[ind]
```

## Plot a map

```{r}
qtm(World,c("Val2007M12","Val2013M01"))
```

